kube-prometheus-stack:
  alertmanager:
    alertmanagerSpec:
      resources:
        requests:
          cpu: 400m
          memory: 300Mi
        limits:
          memory: 500Mi
      storage:
        volumeClaimTemplate:
          spec:
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 10Gi
            selector:
              matchLabels:
                app.kubernetes.io/name: alertmanager

  grafana:
    resources:
      requests:
        cpu: 500m
        memory: 400Mi
      limits:
        memory: 800Mi
    persistence:
      enabled: true
      existingClaim: "grafana"
    admin:
      existingSecret: "grafana-admin-password"

  prometheusOperator:
    resources:
      requests:
        cpu: 200m
        memory: 200Mi
      limits:
        memory: 400Mi

  prometheus:
    prometheusSpec:
      retention: 2d
      resources:
        requests:
          cpu: 400m
          memory: 600Mi
        limits:
          memory: 1200Mi
      storageSpec:
        volumeClaimTemplate:
          spec:
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 10Gi
            selector:
              matchLabels:
                app.kubernetes.io/name: prometheus

ingresses:
  - name: alertmanager
    ssl: true
    httpauth:
      secretName: "alertmanager-http-auth"
      message: "Alertmanager Authentication Required"
    rules:
      - host: "alertmanager.~iac:rke2_catchall_hostname~"
        serviceName: alertmanager-operated
        servicePort: 9093
  - name: grafana
    ssl: true
    rules:
      - host: "grafana.~iac:rke2_catchall_hostname~"
        serviceName: monitoring-grafana
        servicePort: 80

secrets:
  - name: alertmanager-http-auth
    data:
      # htpasswd -nb username password
      auth: "~vault:Projects/k8s/alertmanager:httpauth~"
  - name: grafana-admin-password
    data:
      admin-user: "~vault:Projects/k8s/grafana-admin:admin-user~"
      admin-password: "~vault:Projects/k8s/grafana-admin:admin-password~"
